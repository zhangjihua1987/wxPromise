<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>wxPromise | wxPromise</title>
    <meta name="description" content="强大的、优雅的 小程序 Promise 库">
    
    
    <link rel="preload" href="/wxPromise/assets/css/0.styles.31be3fe6.css" as="style"><link rel="preload" href="/wxPromise/assets/js/app.193298fb.js" as="script"><link rel="preload" href="/wxPromise/assets/js/3.98bda69a.js" as="script"><link rel="prefetch" href="/wxPromise/assets/js/2.61c5963e.js"><link rel="prefetch" href="/wxPromise/assets/js/4.f203e3c3.js"><link rel="prefetch" href="/wxPromise/assets/js/5.a3357517.js"><link rel="prefetch" href="/wxPromise/assets/js/6.99b38140.js"><link rel="prefetch" href="/wxPromise/assets/js/7.9533e25d.js">
    <link rel="stylesheet" href="/wxPromise/assets/css/0.styles.31be3fe6.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div><a href="/wxPromise/" class="home-link router-link-exact-active router-link-active"><!----><span class="site-name">
      wxPromise
    </span></a><div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""><!----></div><nav class="nav-links can-hide"><div class="nav-item"><a href="https://github.com/youngjuning/wxPromise" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><!----></nav></div></header><div class="sidebar-mask"></div><div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="https://github.com/youngjuning/wxPromise" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><!----></nav><ul class="sidebar-links"><li><div class="sidebar-group first"><p class="sidebar-heading open"><span>wxPromise</span><!----></p><ul class="sidebar-group-items"><li><a href="/wxPromise/#普通使用方法" class="sidebar-link">普通使用方法</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/wxPromise/#使用npm" class="sidebar-link">使用NPM</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/wxPromise/#支持-async、await" class="sidebar-link">支持 async、await</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/wxPromise/#支持所有的微信小程序异步api" class="sidebar-link">支持所有的微信小程序异步API</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/wxPromise/#示例代码" class="sidebar-link">示例代码</a></li></ul></li><li><a href="/wxPromise/#扩展的-api" class="sidebar-link">扩展的 API</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/wxPromise/#todo" class="sidebar-link">TODO</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/wxPromise/#license" class="sidebar-link">License</a><ul class="sidebar-sub-headers"></ul></li></ul></div></li></ul></div><div class="page"><div class="content"><h1 id="wxpromise"><a href="#wxpromise" aria-hidden="true" class="header-anchor">#</a> wxPromise</h1><p>强大的、优雅的 小程序 Promise 库，wxPromise 不仅仅把微信小程序所有异步 API promise 化，还把许多优雅的解决方案封装成方法挂载到 <code>wx.pro</code> 对象下。所以在 wxPromise 中，pro 既有 promise 的含义又有扩展的意思。</p><p><a href="https://www.npmjs.com/package/wx-promise-pro" target="_blank" rel="noopener noreferrer"><img src="https://img.shields.io/npm/v/wx-promise-pro.svg" alt="npm"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a><a href="https://www.npmjs.com/package/wx-promise-pro" target="_blank" rel="noopener noreferrer"><img src="https://img.shields.io/npm/dm/wx-promise-pro.svg" alt="npm"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p><p><a href="https://nodei.co/npm/wx-promise-pro/" target="_blank" rel="noopener noreferrer"><img src="https://nodei.co/npm/wx-promise-pro.png?compact=true" alt="NPM"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p><h2 id="普通使用方法"><a href="#普通使用方法" aria-hidden="true" class="header-anchor">#</a> 普通使用方法</h2><p>将 <code>wxPromise.js</code> copy 到 utils 目录中，然后在 <code>app.js</code> 中引入： <code>import './utils/wxPromise.min.js'</code>。</p><p>本库分为两个部分，一部分是将微信小程序原有的API promise 化，一部分是我自己封装的常用方法。两部分的方法都是挂载在 <code>wx.pro</code> 对象下，使用的时候直接使用 <code>wx.pro</code> 对象调用即可。</p><p>如果想要支持 async 和 await，请仔细阅读 <strong>支持 async和await</strong> 这一节。</p><h2 id="使用npm"><a href="#使用npm" aria-hidden="true" class="header-anchor">#</a> 使用NPM</h2><p>如果你在小程序项目中使用的 NPM 来作为包管理器，或者你使用 mpvue 开发小程序，那么可以直接使用 npm 来安装 <code>wx-promise-pro</code></p><div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">npm</span> i wx-promise-pro
</code></pre></div><p>然后使用 nodejs（<code>require('wx-promise-pro')</code>）或者 ES6 Moudle（<code>import 'wx-promise-pro'</code>） 的方式引入。</p><h2 id="支持-async、await"><a href="#支持-async、await" aria-hidden="true" class="header-anchor">#</a> 支持 async、await</h2><blockquote><p>由于 wxPromise 是直接内置了 regenerator-runtime，所以推荐使用压缩版，体积不到10k</p></blockquote><p>页面引入 regeneratorRuntime: <code>import regeneratorRuntime from '/utils/wxPromise.min.js'</code></p><blockquote><p>注意：导入 regeneratorRuntime 和原本 <code>wx.pro</code> 对象是不冲突的，你如果用不到 async 函数，那么可以不导入 regeneratorRuntime</p></blockquote><p><a href="/wxPromise/detail/async.html">点击</a> 查看关于 async 的 demo，或者 <a href="http://es6.ruanyifeng.com/#docs/async" target="_blank" rel="noopener noreferrer">点击<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 学习 async 的语法。</p><h2 id="支持所有的微信小程序异步api"><a href="#支持所有的微信小程序异步api" aria-hidden="true" class="header-anchor">#</a> 支持所有的微信小程序异步API</h2><p>从 2.0.0 开始，我们引入了下面这段代码，来一劳永逸地支持所有的 异步 api。开发者无需关心兼容与否，只要是 <code>wx</code> 支持的 api，<code>wx.pro</code> 全部支持。</p><h3 id="示例代码"><a href="#示例代码" aria-hidden="true" class="header-anchor">#</a> 示例代码</h3><div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 演示 wxPromise 的能力</span>
wx<span class="token punctuation">.</span><span class="token function">showLoading</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  title<span class="token punctuation">:</span> <span class="token string">'加载中'</span><span class="token punctuation">,</span>
  mask<span class="token punctuation">:</span> <span class="token boolean">true</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
wx<span class="token punctuation">.</span>pro<span class="token punctuation">.</span><span class="token function">request</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  url<span class="token punctuation">:</span> <span class="token string">'https://cnodejs.org/api/v1/topics'</span><span class="token punctuation">,</span>
  data<span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
  method<span class="token punctuation">:</span> <span class="token string">'GET'</span><span class="token punctuation">,</span>
  header<span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token string">'content-type'</span><span class="token punctuation">:</span> <span class="token string">'application/json'</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>res <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">catch</span><span class="token punctuation">(</span>err <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">finally</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  wx<span class="token punctuation">.</span><span class="token function">hideLoading</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h2 id="扩展的-api"><a href="#扩展的-api" aria-hidden="true" class="header-anchor">#</a> 扩展的 API</h2><ol><li><a href="/wxPromise/detail/showTopTips.html">showTopTips(OBJECT,this)</a>：顶部提示框</li><li><a href="/wxPromise/detail/match.html">match(type,str)</a>：正则匹配方法</li><li>initChart(option,echarts)：初始化 Echarts 的方法</li><li><a href="/wxPromise/detail/lazyInitChart.html">lazyInitChart(option,echarts,componentId,that)</a>：echarts 延迟加载模式初始化</li><li>updateChart(chart,option)：echats 没有提供 update 的方法，因此我们利用 clear() 和 setOption() api 组合实现了这个功能</li><li>saveImageToPhotosAlbum(tempFilePath)：带有授权解决方案的保存图片到系统相册方法</li><li>canvasToTempFilePath(canvasContext)：把当前画布指定区域的内容导出生成指定大小的图片，并返回文件路径</li></ol><h2 id="todo"><a href="#todo" aria-hidden="true" class="header-anchor">#</a> TODO</h2><ul><li>[x] 排除所有的同步 API，让用户可以彻底抛弃 wx 对象</li><li>[x] 支持 ES2017 的 <a href="http://t.cn/RyUUVvA" target="_blank" rel="noopener noreferrer">async 函数<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li>[x] 支持 ES2018 的 <a href="http://t.cn/RuJyewc" target="_blank" rel="noopener noreferrer">finally<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li>[ ] 集成 donghaohao/vuefy <a href="https://github.com/donghaohao/vuefy" target="_blank" rel="noopener noreferrer"><img src="https://img.shields.io/github/stars/donghaohao/vuefy.svg?style=social&label=Stars" alt="GitHub stars"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 以支持 watch 和 computed</li><li>[ ] 集成 <code>wx-queue-request</code> 控制微信小程序 <code>wx.request</code> 并发请求数量</li><li>[ ] 集成 <code>WxValidate.js</code> 来提供 类 jquery validate 的表单验证 或 借鉴 element-ui 的表单验证功能 https://github.com/mengdu/validator.js</li><li>[ ] 编写所有扩展API的文档</li></ul><h2 id="license"><a href="#license" aria-hidden="true" class="header-anchor">#</a> License</h2><p>MIT License</p><p>Copyright (c) 2018 youngjuning</p><p>Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the &quot;Software&quot;), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:</p><p>The above copyright notice and this permission notice shall be included in all
copies or substantial portions of the Software.</p><p>THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
SOFTWARE.</p></div><div class="page-edit"><!----><!----></div><!----></div></div></div>
    <script src="/wxPromise/assets/js/3.98bda69a.js" defer></script><script src="/wxPromise/assets/js/app.193298fb.js" defer></script>
  </body>
</html>
